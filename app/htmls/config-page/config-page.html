<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="de-DE">
  <head>
    <meta name="color-scheme" content="light dark" />
    <meta charset="UTF-8">
    <link rel="icon" id="favicon" href="../../images/F-D_dark.png" />
    <link rel="stylesheet" href="./config-page.css" />
    <title>Settings F-PKI Plugin</title>
  </head>
  <body>
    <div id="options" style="margin-bottom: 100px;">
      <h1>F-PKI Settings</h1>

      <p>
        Sie finden <b>weiterführende Informationen</b> zu jeder der
        Einstellungen über die entsprechenden <b>Infoboxen <q>&#9432;</q></b>.
      </p>
      <p>
        Für einen <b>tieferen Einblick</b> in F-PKI empfehlen wir die <a
        href="#">F-PKI Dokumentation</a> oder das originale Paper <q><a
        href="https://netsec.ethz.ch/publications/papers/chuat2022fpki.pdf">F-PKI:
        Enabling Innovation and Trust Flexibility in the HTTPS Public-Key
        Infrastructure</a></q>.
      </p>
      


      <!-- LEGACY TRUST PREFERENCES -->
      <div class="settings-section" id="user-policies-settings-section">
        <div class="settings-section-header">
          <h2 style="display: inline-block;">User Policies</h2>
          <span class="info-icon">&#9432;</span>
          <div class="info-box" hidden>
            <p>
              User Policies ermöglichen die feinere <b>Differenzierung von
              Vertrauen</b>, das der Nutzer bestimmten CAs für bestimmte Domains
              entgegenbringt.
            </p>
            <p>
              User Policies haben eine oder mehrere <span
              class="keyword">Domains</span> als <b>Scope</b>.
            </p>
            <p>
              Domains können mit <b>Wildcards</b> angegeben werden, d.h. <span
              class="code">*.example.com</span> oder <span
              class="code">*.de</span> sind valide Angaben, um alle Subdomains
              von example.com bzw. alle Domains mit <q>de</q> als
              Top-Level-Domain zu selektieren
            </p>
            <p>
              Innerhalb dieses Scopes können für beliebig viele <span
              class="keyword">CA-Sets</span> (<a
              href="#ca-sets-settings-section">hier</a>
              konfigurierbar) individuelle <span
              class="keyword">Trust Level</span> gewählt werden:
            </p>

            <ul>
              <li style="margin-bottom: 5px;">
                <b>Untrusted:</b> Zertifikate werden nicht akzeptiert
              </li>
              <li style="margin-bottom: 5px;">
                <b>Standard Trust:</b> Zertifikate werden akzeptiert, esseidenn
                es existieren Zertifikate für die Domain, welche von CAs mit
                konfiguriertem Trust-Level <span class="code">High Trust</span>
                oder <span class="code">Perfect Trust</span> ausgestellt
                wurden.<sup>1,2</sup>
              </li>
              <li>
                <b>High Trust:</b> Zertifikate werden akzeptiert, esseidenn es
                existieren Zertifikate für die Domain, welche von CAs mit
                konfiguriertem Trust-Level <span class="code">Perfect
                Trust</span> ausgestellt wurden.<sup>1,2</sup>
              </li>
              <li>
                <b>Perfect Trust:</b> Zertifikate werden akzeptiert.<sup>1</sup>
              </li>
            </ul>

            <div style="margin-top: 25px; display: flex; flex-direction: column; align-items: center;">
              <figure style="width: 38%;">
                <img 
                  src="user_policies.png" 
                  alt="Schaubild, das User Policies demonstriert"
                  width="100%""
                  style="border: 2px solid black; border-radius: 10px;"
                >
                <figcaption style="font-size: small;">
                  User 1 (U<sub>1</sub>) benutzt Zertifikat 1 (C<sub>1</sub>)
                  anstelle von Zertifikat 2 (C<sub>2</sub>), weil er der
                  Zertifizierungsstelle 1 (CA<sub>2</sub>) mehr vertraut aus
                  Zertifizierungsstelle 2 (CA<sub>2</sub>).
                </figcaption>
              </figure>
            </div>

            <p style="margin-left: 25px;">
              <sup>1</sup> Zertifikate können auch durch <a href="#">Domain
              Policies</a> invalidiert werden.
              <br>
              <sup>2</sup> Existierende Zertifikate werden von <a
              href="#">Mapservern</a> gesammelt und zur Verfügung gestellt, die
              ähnlich wie Certificate-Transparency-Logs funktionieren.
            </p>
          </div>
        </div>

        <div class="todo">
          <p>
            1. Automatisch prüfen, dass keine doppelten Präferenzen bestehen,
            oder sich Policies wiedersprechen oder Domain doppelt ist etc..<br>
            2. Trust Color-Coden?
          </p>
        </div>
        
        <table id="legacy-trust-preference-table">
          <thead>
              <tr>
                <th colspan="1" rowspan="2">Domain</th>
                <th colspan="2">Preferences</th>
                <th rowspan="2"></th>
              </tr>
              <tr>
                <th><span style="border: 2px dotted white;">CA Set</span></th>
                <th>Trust Level</th>
              </tr>
          </thead>
          <tbody id="legacy-trust-preference-table-body">
                <!-- Table generated by javascript-->
          </tbody>
        </table>

        <!-- TEST -->
        <table>
          <thead>
            <tr>
              <th colspan="2" style="font-size: larger;">Domain</th>
              <th rowspan="2"></th>
            </tr>
            <tr>
              <th>CA Set</th>
              <th>Trust Level</th>
            </tr>
          </thead>
          <tbody>
            <tr class="text-align: center;">
              <td colspan="2" style="font-size: larger; background-color: #F2D995; height: 30px; text-align: center; font-weight:bolder;">
                *.example.com
              </td>
              <td class="btn" style="font-size: larger; font-weight: bolder; height: 30px; background-color:#F2D995;">
                -
              </td>
            </tr>
            <!--
            <tr>
              <td colspan="2" style="padding: 0; border: none;">
                <table class="inner-table">
                  <tbody>
                    <tr>
                      <td>All CAs</td>
                      <td>Standard Trust</td>
                    </tr>
                    <tr>
                      <td>German CAs</td>
                      <td>High Trust</td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
            -->
            </tbody>
            <tbody style="border: 2px solid black;">
            <tr>
              <td style="padding: 0; border: none;">
                <select style="height: 30px;background-color: #56CAC0;">
                  <option style="text-align:center;">All CAs</option>
                  <option value="">German CAs</option>
                </select>
              </td>
              <td style="padding: 0; border: none;">
                <select style="height: 30px;background-color: #56CAC0;">
                  <option style="text-align:center;">Standard Trust</option>
                  <option value="">High Trust</option>
                </select>
              </td>
              <td class="btn" style="text-align: center;">x</td>
            </tr>
            <tr>
              <td style="padding: 0; border: none;">
                <select style="height: 30px;background-color: #56CAC0;">
                  <option style="text-align:center;">All CAs</option>
                  <option selected value="">German CAs</option>
                </select>
              </td>
              <td style="padding: 0; border: none;">
                <select style="height: 30px;background-color: #56CAC0;">
                  <option style="text-align:center;">Standard Trust</option>
                  <option selected>High Trust</option>
                </select>
              </td>
              <td class="btn" style="text-align: center;">x</td>
            </tr>
            <tr>
              <td style="padding: 0; border: none;">
                <select style="height: 30px;background-color: #56CAC0;">
                  <option style="text-align:center;">Select</option>
                  <option value="">German CAs</option>
                </select>
              </td>
              <td style="padding: 0; border: none;">
                <select style="height: 30px; background-color: #56CAC0; font-weight:600;">
                  <option style="text-align:center;">Select</option>
                  <option value="">High Trust</option>
                </select>
              </td>
              <td class="btn" style="text-align: center;">x</td>
            </tr>
            <tr>
              <td colspan="2" class="btn" style=" font-weight: bolder; color: whitesmoke; height:30px; background-color:#3D7F6E; font-size: larger;">+</td>
            </tr>
            <tr>
              <td colspan="3" style="height: 20px; border: none;">

              </td>
            </tr>
            </tbody>
            
            <tbody>
            <tr class="text-align: center;">
              <td colspan="2" style="font-size:larger; background-color: #F2D995; height: 30px; text-align: center; font-weight:bolder;">
                *.com
              </td>
              <td class="btn" style="font-size: larger; font-weight: bolder; background-color:#F2D995;">
                +
              </td>
            </tr>
            </tbody>
            <tbody hidden>
            <tr>
              <td style="padding: 0; border: none;">
                <select style="height: 30px;">
                  <option style="text-align:center;">All CAs</option>
                  <option value="">German CAs</option>
                </select>
              </td>
              <td style="padding: 0; border: none;">
                <select style="height: 30px;">
                  <option style="text-align:center;">Standard Trust</option>
                  <option value="">High Trust</option>
                </select>
              </td>
              <td class="btn" style="text-align: center;">x</td>
            </tr>
            <tr>
              <td style="padding: 0; border: none;">
                <select style="height: 30px;">
                  <option style="text-align:center;">All CAs</option>
                  <option selected value="">German CAs</option>
                </select>
              </td>
              <td style="height: 30px; padding: 0; border: none;">
                <select style="height: 30px; color: #56CAC0;">
                  <option style="text-align:center;">Standard Trust</option>
                  <option selected>High Trust</option>
                </select>
              </td>
              <td class="btn" style="text-align: center;">x</td>
            </tr>
          </tbody>
          <tbody>
            <tr>
              <td colspan="2" style="padding:0;">
                <input  type="text" placeholder="___" 
                        style="background-color:#F2D995; height: 35px; text-align: center; font-weight: bolder; font-size: larger;">
              </td>
              <td class="btn" style="font-size: larger; font-weight: bolder; background-color:#F2D995;">
                +
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3">
                <span style="visibility: hidden;">hi</span>
              </td>
            </tr>
          </tfoot>
        </table>

        <button class="reset-changes legacy-trust-preference">
                Reset Changes
        </button>
        <button class="save-changes legacy-trust-preference">
                Save Changes
        </button>
      </div>


      <!-- CA SETS -->
      <div class="settings-section" id="ca-sets-settings-section">
        <div class="settings-section-header">
          <h2 style="display: inline-block;">CA Sets</h2>
          <span class="info-icon">&#9432;</span>
          <div class="info-box" hidden>
            <p>
              CA Sets sind <b>Mengen von Root CAs</b> (Certificate Authorities),
              die sich in dem <b>Trust Store</b> deines Browsers befinden.
            </p>
            <p>
              Sie haben einen <span class="keyword">Set Namen</span> über den
              sich das <span class="keyword"> CA Set</span> in <a
              href="#user-policies-settings-section">User Policies</a>
              ansprechen lässt, um individuelle <b>Trust Levels</b> zu
              konfigurieren.
            </p>
          </div>
        </div>

        <div class="todo">
          <p>
            1. CAs aus Liste selektierbar machen (Mit Filteroptionen, wie von
            Interview 1 vorgeschlagen/erwartet)<br>
            2. Predefined CA Sets
          </p>
        </div>

        <table id="ca-sets-table">
          <thead>
              <tr>
                  <th colspan="1">Set Name</th>
                  <th colspan="1">CA Set</th>
                  <th></th>
              </tr>
          </thead>
          <tbody id="ca-sets-table-body">
              <!-- javascript generated -->
          </tbody>
        </table>
        <button class="reset-changes ca-sets">Reset Changes</button>
        <button class="save-changes ca-sets">Save Changes</button>
      </div>


      <!-- POLICY TRUST PREFERENCES -->
      <div class="settings-section pca-preferences-settings-section">
        <div class="settings-section-header">
          <h2 style="display: inline-block;">User Policies (PCA)</h2>
          <span class="info-icon">&#9432;</span>
          <div class="info-box" hidden>
            <p>
              PCAs (Policy-Certificate-Authorities) stellen <b>Zertifikate für
              Domain Policies</b> der Domainbetreiber aus. Für weitere
              Informationen zu Domain Policies siehe <a href="">hier</a>.
            </p>
            <p>
              Diese Settings verhalten sich analog zu den <a
              href="#user-policies-settings-section">User Policies</a> für
              übliche CAs:
            </p>
            <div style="font-weight:300;">
              <p>
                User Policies haben eine oder mehrere <span
                class="keyword">Domains</span> als <b>Scope</b>.
              </p>
              <p>
                Domains können mit <b>Wildcards</b> angegeben werden, d.h. <span
                class="code">*.example.com</span> oder <span
                class="code">*.de</span> sind valide Angaben, um alle Subdomains
                von example.com bzw. alle Domains mit <q>de</q> als
                Top-Level-Domain zu selektieren
              </p>
              <p>
                Innerhalb dieses Scopes können für beliebig viele <span
                class="keyword">PCAs</span> <!--(<a
                href="#pcas-settings-section">hier</a>
                konfigurierbar)--> individuelle <span class="keyword">Trust
                Level</span> gewählt werden:
              </p>

              <ul>
                <li style="margin-bottom: 5px;">
                  <b>Untrusted:</b> Policy-Zertifikate werden nicht akzeptiert
                </li>
                <li style="margin-bottom: 5px;">
                  <b>Trusted:</b> Policy-Zertifikate werden akzeptiert, esseidenn
                  es existieren Policy-Zertifikate für die Domain, welche von PCAs
                  mit konfiguriertem Trust-Level <span class="code">High
                  Trust</span>
                  oder <span class="code">Perfect Trust</span> ausgestellt
                  wurden.<sup>1</sup>
                </li>
                <li>
                  <b>High Trust:</b> Policy-Zertifikate werden akzeptiert,
                  esseidenn es existieren Policy-Zertifikate für die Domain,
                  welche von PCAs mit konfiguriertem Trust-Level <span
                  class="code">Perfect Trust</span> ausgestellt
                  wurden.<sup>1</sup>
                </li>
                <li>
                  <b>Perfect Trust:</b> Policy-Zertifikate werden akzeptiert.
                </li>
              </ul>

              <p style="margin-left: 25px;">
                <sup>1</sup> Existierende Policy-Zertifikate werden von <a
                href="#">Mapservern</a> gesammelt und zur Verfügung gestellt, die
                ähnlich wie Certificate-Transparency-Logs funktionieren.
              </p>
            </div>
          </div>
        </div>


        <table id="policy-trust-preference-table">
          <thead>
              <tr>
                <th colspan="1" rowspan="2">Domain</th>
                <th colspan="2">Preferences</th>
                <th rowspan="2"></th>
              </tr>
              <tr>
                <th>PCA</th>
                <th>Trust Level</th>
              </tr>
          </thead>
          <tbody id="policy-trust-preference-table-body">
                <!-- Table generated by javascript-->
          </tbody>
        </table>
        <button class="reset-changes policy-trust-preference">Reset Changes</button>
        <button class="save-changes policy-trust-preference">Save Changes</button>
      </div>

      
      <hr style="margin-top: 50px; margin-bottom: 20px;">


      <!-- 
        ADVANCED SETTINGS 
      -->
      <h1 style="display: inline-block;">Advanced Settings</h1>
      <button 
        id="advancedButton"
        style="padding: 6px;
               margin-left: 10px;
               position: relative;
               top: -4px;
               font-size: larger;
               font-weight: bold;
               border-width: 3px;
               border-style: groove;
               border-radius: 10px;">
        Show
      </button>

      <div id="advanced-settings" hidden="">

        <p>
          Diese Einstellungen richten sich an <b>fortgeschrittene Benutzer</b>. 
        </p>
        <p>
          Bitte nimm <b>keine Änderungen</b> an den Einstellungen vor, wenn du dir
          unsicher bist.
        </p>

        <!-- TODO: Placement -->
        <button id="resetConfig">Reset Config to Default</button>
        

        <!-- MAPSERVER SETTINGS -->
        <div class="settings-section">
          <h2>Mapservers</h2>
          <table id="mapservers-table">
            <thead>
                <tr>
                    <th colspan="1">Identity</th>
                    <th colspan="1">Domain</th>
                    <th colspan="1">Query Type</th>
                    <th colcpan="1">Action</th>
                </tr>
            </thead>
            <tbody id="mapservers-table-body">
                <!-- Mapservers will be inserted based on JSON configuration -->
            </tbody>
          </table>
          <button class="reset-changes mapservers">Undo Changes</button>
          <button class="save-changes mapservers">Save Changes</button>
        </div>


        <!-- OTHER SETTINGS -->
        <div class="settings-section">
          <h2>Other Settings</h2>
          <table id="other-table">
            <thead>
                <tr>
                    <th colspan="1">Setting</th>
                    <th colspan="1">Value</th>
                </tr>
            </thead>
            <tbody id="other-table-body">
                <tr>
                  <td>Cache Timeout: </td>
                  <td><input type="int" class="cache-timeout" /></td>
                </tr>
                <tr>
                  <td>Max Connection Setup Time: </td>
                  <td><input type="int" class="max-connection-setup-time" /></td>
                </tr>
                <tr>
                  <td>Proof Fetch Timeout: </td>
                  <td><input type="int" class="proof-fetch-timeout" /></td>
                </tr>
                <tr>
                  <td>Proof Fetch Max Tries: </td>
                  <td><input type="int" class="proof-fetch-max-tries" /></td>
                </tr>
                <tr>
                  <td>Mapserver Quorum: </td>
                  <td><input type="int" class="mapserver-quorum" /></td>
                </tr>
                <tr>
                  <td>Mapserver Instances Queried: </td>
                  <td><input type="int" class="mapserver-instances-queried" /></td>
                </tr>
                <tr>
                  <td>Send Log Entries via Event: </td>
                  <td><input type="int" class="send-log-entries-via-event" /></td>
                </tr>
                <tr>
                  <td>Wasm Certificate Parsing: </td>
                  <td><input type="int" class="wasm-certificate-parsing" /></td>
                </tr>
            </tbody>
          </table>
          <button class="reset-changes other-settings">Reset Changes</button>
          <button class="save-changes other-settings">Save Changes</button>
        </div>

        <div id="output">
          <h2>JSON Config</h2>
          <p>
            Die gesamten Einstellungen auf dieser Seite können im JSON-Format
            heruntergeladen, bearbeitet sowie hochgeladen werden.
          </p>
          <p>
            Nutzen Sie nur Settings-Dateien aus <b>vertrauenswürdigen
            Quellen</b>!
          </p>

          <div style="line-height: 2;">
            <button id="printConfig">Print Config</button>
            <br/>
            <button id="downloadConfig">Download Config</button>
            <br/>
            <label for="file">Upload new config:</label>
            <input type="file" id="file" onchange="handle_files()">
            <button id="uploadConfig">Upload</button>
          </div>
          <pre class="default-border">
            <code id="config-code">
              { "hello": "world" }
            </code>
          </pre>
        </div>

      </div>
    </div>

    

    <script type="module" src="./config-page.js"></script>
  </body>
</html>
